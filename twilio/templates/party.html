<!doctype html>
<html>

<head>
    <link rel="stylesheet" href="../static/css/bootstrap.min.css" type="text/css">
    <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='styles.css') }}">
</head>

<body>
    <h1 style="text-align: center; margin-top: 5px;">{{ room }}</h1><br>

    <form>
        <div id="joining_details" style="display: flex; justify-content: center;">
            <input type="text" class="form-control-lg" name="username" id="username" placeholder="Enter Username"
                style="margin: 2px">
            <button id="join_leave" class="btn btn-warning">Join Call</button>
        </div>
        <br>
        <div class="start_party">
            <button onclick="NewTab()" class="btn btn-warning mx-1">Open Myntra</button>
            <button id="share_screen" class="btn btn-warning mx-1" disabled>Share screen</button>
            <button id="toggle_chat" class="btn btn-warning mx-1" disabled style="display: none;">Toggle chat</button>
            <button id="toggle_mode" class="btn btn-warning mx-1" disabled>Toggle mode</button>
            <button id="unmute_audio" class="btn btn-warning mx-2 mx-1" disabled>Unmute Audio</button>
            <button id="show_video" class="btn btn-warning mx-2 mx-1" disabled>Show Video</button>
        </div>

    </form>
    <div style="display: flex; justify-content: center; margin-top: 5px;">
        <h5 id="count">Disconnected.</h5>
    </div>

    <div class="start_party">
        <div class="nav flex-column nav-pills" id="v-pills-tab" role="tablist" aria-orientation="vertical">
            <a class="nav-link active" id="v-pills-chat-tab" data-toggle="pill" href="#v-pills-chat" role="tab"
                aria-controls="v-pills-chat" aria-selected="true"
                style="text-align: center; width: 25%; margin-left: auto; margin-right: auto;  margin-top: 50px;">Chat</a>
            <a class="nav-link" id="v-pills-poll-tab" data-toggle="pill" href="#v-pills-poll" role="tab"
                aria-controls="v-pills-poll" aria-selected="false"
                style="text-align: center; width: 25%; margin-left: auto; margin-right: auto;  margin-top: 15px;">Poll</a>
        </div>
        <div class="tab-content" id="v-pills-tabContent">
            <div class="tab-pane fade show active" id="v-pills-chat" role="tabpanel" aria-labelledby="v-pills-chat-tab">
                <div id="root">
                    <div id="container" class="realtime container">
                        <div id="local" class="participant">
                            <div></div>
                            <div class="label">Me</div>
                        </div>
                        <!-- more participants will be added dynamically here -->
                    </div>
                    <div id="chat">
                        <div id="chat-scroll">
                            <div id="chat-content">
                                <!-- chat content will be added dynamically here -->
                            </div>
                        </div>
                        <input placeholder="Type your message here" id="chat-input" type="text">

                    </div>
                </div>
            </div>
            <div class="tab-pane fade" id="v-pills-poll" role="tabpanel" aria-labelledby="v-pills-poll-tab">
                <div id="poll_here" style="display: none;">
                    <form id="submit_url">
                        <!--<label for="polling">Enter URL: </label>-->
                        <input type="text" placeholder="Item URL" name="polling" id="polling" required>
                        <input type="submit" id="start_poll" value="Start Poll" />
                    </form>

                    <div id="polling_url"></div>
                    <form action="/poll" id="choices" style="display: none;" target="_blank">
                        {% for e in data.fields %}
                        <input type="submit" name="field" value="{{ e }}">
                        {% endfor %}
                        <!-- <input type="submit" value="Vote" /> -->
                    </form>
                    <form action="/endPoll" target="_blank">
                        <button type="submit" id="end_poll" style="display: none;">End Poll</button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <script src="../static/js/jquery-3.5.1.min.js"></script>
    <script src="../static/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="//code.jquery.com/jquery-1.11.0.min.js"></script>
    <script type="text/javascript" src="//code.jquery.com/jquery-migrate-1.2.1.min.js"></script>

    <script src="https://media.twiliocdn.com/sdk/js/video/releases/2.3.0/twilio-video.min.js"></script>
    <script src="https://media.twiliocdn.com/sdk/js/conversations/releases/1.0.0/twilio-conversations.min.js"></script>
    <script src="{{ url_for('static', filename='app.js') }}"></script>
    <script>
        function NewTab() {
            event.preventDefault();
            window.open(
                "https://www.myntra.com", "_blank");
        }

        var endPoll = document.getElementById("end_poll");
        endPoll.onclick = function () {
            document.getElementById("submit_url").style.display = "flex";
            document.getElementById("choices").style.display = "none";
            document.getElementById("polling_url").innerHTML = "";
            endPoll.style.display = "none";
            console.log("hlo end poll");
            var itemURL = document.getElementById("polling").value;
            fetch("/endPoll", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json",
                },
                body: JSON.stringify({ content: itemURL }),
            })
                .then((res) => res.json())
                .then((itemURL) => {
                    console.log(itemURL);
                    // window.location.pathname = '/endPoll'
                })
                .catch((err) => {
                    console.log(err);
                });
        };
    </script>

</body>

</html>